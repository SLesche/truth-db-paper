---
editor_options:
  chunk_output_type: console
---
<!-- # Library calls -->
```{r data-analysis-setup}
library(tidyverse)
library(data.table)
library(lme4)
library(afex)
```


```{r}
analysis_data <- full_data %>% 
  filter(phase == "test") %>% 
  filter(!is.na(repeated), !is.na(response))
```

```{r}
prep_aov <- function(data){
  data %>% 
    group_by(subject, repeated) %>% 
    summarize(mean_resp = mean(response, na.rm = FALSE))
}

run_simple_aov <- function(data) {
  aov_ez(
    id = "subject",
    dv = "mean_resp",
    within = "repeated",
    data = data
  )
}

results <- analysis_data %>% 
  nest(.by = procedure_id) %>% 
  mutate(
    aov_data = map(data, prep_aov)
  ) %>% 
  mutate(
    n_trials = map_dbl(data, nrow),
    n_subjects = map_dbl(data, ~length(unique(.$subject))),
    aov_results = map(aov_data, run_simple_aov)
  )

summary(simple_aov)
effectsize::omega_squared(simple_aov)
effectsize::eta_squared(simple_aov)

```



